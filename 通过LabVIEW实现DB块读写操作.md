# 通过LabVIEW实现DB块读写操作

## 读DB块

读DB块的数据，可以使用**Cli_DBRead**方法，这个方法和之前Python里面用到的大同小异，参数也很好理解，下图是这个方法的说明

![1560671971865](H:\snap7ForS71200\1560671971865.png)

可以看出，这个方法就是把Cli_ReadArea方法中的两个参数直接赋值了，使用的时候，只需要给剩下四个参数进行复制，**DBNumber**是DB块编号，**Start**是DB块数据起始地址，**Size**是DB块中数据总长度。pUserData是缓冲区地址数组。

我们还使用之前用过的DB块数据，如下图

![1560672272280](H:\snap7ForS71200\1560672272280.png)

数据总长度是268个字节，Cli_DBRead方法的LabVIEW框图如下

![1560672363595](H:\snap7ForS71200\1560672363595.png)

Buffer参数需要预先定义一个长度是268的数组，里面的数据无所谓，但是长度一定要和DB块数据长度一致，不然会出错。返回值如果为0，则说明成功执行了读操作。

读回来的数据是一个字节数组，需要按照偏移量和数据类型对应的数据长度取出字节后转换成对应的数据类型，LabVIEW框图如下

![1560672567575](H:\snap7ForS71200\1560672567575.png)

可以看到，按照不同的偏移量和数据长度取出子数组，之后用不同的方法处理字节数组，得到正确的数据。执行的效果如下图：

![1560672740773](H:\snap7ForS71200\1560672740773.png)



## 写Q区

读DB块的数据，可以使用**Cli_DBWrite**方法，下图是这个方法的说明

![1560672825197](H:\snap7ForS71200\1560672825197.png)

唯一的不同是需要将写入的数据放到pUserData数组中

LabVIEW的框图如下图

![1560672865552](H:\snap7ForS71200\1560672865552.png)

需要依次将数据转换成字节数组，之后按照顺序构建一个268字节长度的字节数组传递给Buffer参数，最终效果如下图

![1560674152793](H:\snap7ForS71200\1560674152793.png)

